{"ast":null,"code":"import React,{Component}from'react';import rpc from'utils/rpc';import withPayment from'components/Common/with-payment';import PrimaryTitle from'components/Common/primary-title';import OutlineButton from'components/Common/outline-button';import GradientButton from'components/Common/gradient-button';import TotalPrice from'components/Common/total-price';import Current from'./current';import Input from'./input';const products={fuel:'Паливо',jerrycan:'Каністра',repair_kit:'Рем. комплект'};class Gas extends Component{constructor(){super(...arguments);this.state={type:'low',fuel:{current:0,max:0},basket:{},prices:{}};}componentDidMount(){this.setState(()=>({...this.props.location.state,basket:this.getEmptyBasket()}));}changeBasketItem(name,amount){this.setState(state=>({basket:{...state.basket,[name]:amount}}));}getEmptyBasket(){const basket={};Object.keys(products).forEach(name=>{basket[name]=0;});return basket;}getTotalPrice(){const{prices,basket}=this.state;const price=Object.entries(basket).reduce((sum,_ref)=>{var _prices$name;let[name,amount]=_ref;return sum+amount*((_prices$name=prices[name])!==null&&_prices$name!==void 0?_prices$name:0);},0);return price;}async buy(payment){const{fuel,basket}=this.state;await rpc.callServer('Gas-Buy',[basket,payment]);this.setState(()=>({basket:this.getEmptyBasket(),fuel:{...fuel,current:fuel.current+(basket.fuel||0)}}));}render(){const{type,fuel,prices,basket}=this.state;return/*#__PURE__*/React.createElement(\"div\",{className:\"gas\"},/*#__PURE__*/React.createElement(Current,{percent:fuel.current*100/fuel.max||0,type:type}),/*#__PURE__*/React.createElement(\"div\",{className:\"gas_main\"},/*#__PURE__*/React.createElement(PrimaryTitle,{className:\"gas_main-title\"},\"\\u0417\\u0430\\u043F\\u0440\\u0430\\u0432\\u043A\\u0430\"),/*#__PURE__*/React.createElement(\"div\",{className:\"gas_fields\"},Object.entries(products).map(_ref2=>{let[key,name]=_ref2;return/*#__PURE__*/React.createElement(\"div\",{className:\"gas_fields-item\",key:key},/*#__PURE__*/React.createElement(\"div\",{className:\"header\"},/*#__PURE__*/React.createElement(\"span\",{className:\"header_name\"},name),/*#__PURE__*/React.createElement(\"span\",{className:\"header_price\"},prices[key],\" $\")),/*#__PURE__*/React.createElement(Input,{value:basket[key],min:0,max:key==='fuel'?fuel.max-fuel.current:20,onChange:this.changeBasketItem.bind(this,key)}));})),/*#__PURE__*/React.createElement(TotalPrice,{className:\"gas_price\",value:this.getTotalPrice()}),/*#__PURE__*/React.createElement(\"div\",{className:\"gas_buttons\"},/*#__PURE__*/React.createElement(OutlineButton,{onClick:()=>rpc.callClient('Gas-CloseMenu')},\"\\u0417\\u0430\\u043A\\u0440\\u0438\\u0442\\u0438\"),/*#__PURE__*/React.createElement(GradientButton,{onClick:()=>this.props.showPayment(this.buy.bind(this))},\"\\u041A\\u0443\\u043F\\u0438\\u0442\\u0438\"))));}}export default withPayment(Gas);","map":null,"metadata":{},"sourceType":"module"}